<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Kana Shoot</title>
  <link rel="stylesheet" href="/game/style.css">
</head>
<body>
  <a href="/#editor" class="nav-link" target="_parent">Editor</a>

  <div id="start-screen">
    <h1>Kana Shoot</h1>
    <p class="subtitle">Type romaji, press Enter to fire</p>
    <div class="options">
      <label>Mode</label>
      <select id="opt-mode-type">
        <option value="single">Single letter</option>
        <option value="random">Random letter combo</option>
        <option value="smart">Smart (practice weak)</option>
        <option value="words">Words (from list)</option>
        <option value="images">Images</option>
        <option value="english">English meaning</option>
        <option value="kana-to-english">Kana to English</option>
      </select>

      <span id="letter-options">
        <span id="character-set-wrap">
          <label>Characters</label>
          <select id="opt-characters">
            <option value="hiragana">Hiragana only</option>
            <option value="katakana">Katakana only</option>
            <option value="both">Both</option>
            <option value="custom">Custom</option>
          </select>
          <button type="button" id="btn-custom-chars" class="btn-secondary hidden">Select characters…</button>
        </span>
        <span id="smart-chars-wrap" class="hidden">
          <label>Script</label>
          <select id="opt-smart-script">
            <option value="hiragana">Hiragana only</option>
            <option value="katakana">Katakana only</option>
            <option value="both">Both</option>
          </select>
          <button type="button" id="btn-smart-chars" class="btn-secondary">View characters</button>
        </span>
        <span id="word-length-wrap" class="hidden">
          <label>Word length</label>
          <input type="number" id="opt-word-min" value="2" min="1" max="6" title="Min">
          <span class="opt-sep">–</span>
          <input type="number" id="opt-word-max" value="5" min="1" max="6" title="Max">
        </span>
      </span>

      <label>Spawn</label>
      <select id="opt-spawn">
        <option value="zen">Zen (fixed)</option>
        <option value="ramping">Ramping</option>
      </select>
      <label id="zen-label">Interval (sec)</label>
      <input type="number" id="opt-interval" value="1" min="0.5" max="3" step="0.5">
      <label>Fall speed</label>
      <select id="opt-fallspeed">
        <option value="0.05">Slowest</option>
        <option value="0.1">Very slow</option>
        <option value="0.15">Slower</option>
        <option value="0.25">Slow</option>
        <option value="0.45" selected>Medium</option>
        <option value="0.7">Fast</option>
      </select>
      <label>Lives</label>
      <input type="number" id="opt-lives" value="3" min="1" max="20">
      <label class="opt-checkbox">
        <input type="checkbox" id="opt-show-kana-typing">
        Show kana while typing
      </label>
    </div>
    <button id="btn-start">Start</button>
    <button type="button" id="btn-stats" class="btn-secondary btn-stats">Stats</button>
    <button type="button" id="btn-sessions" class="btn-secondary">Sessions</button>
    <div class="data-actions">
      <button type="button" id="btn-export" class="btn-secondary">Export</button>
      <button type="button" id="btn-import" class="btn-secondary">Import</button>
    </div>
  </div>

  <div id="game-screen" class="hidden">
    <div class="hud">
      <span id="score">0</span>
      <span id="lives-display">3</span>
      <span id="multiplier">1×</span>
      <button type="button" id="btn-quit">Quit</button>
    </div>
    <div class="game-content">
      <div id="play-area">
        <div id="symbols"></div>
        <div id="projectiles"></div>
        <div id="particles"></div>
      </div>
      <div id="romaji-sidebar" class="romaji-sidebar hidden">
        <div class="romaji-sidebar-title">This game</div>
        <div id="romaji-sidebar-list"></div>
      </div>
    </div>
    <div class="input-wrap">
      <input type="text" id="input" placeholder="type romaji…" autocomplete="off" autofocus>
      <span class="hint">Enter to fire</span>
      <div id="kana-preview" class="kana-preview hidden"></div>
    </div>
    <div id="game-over" class="hidden">
      <p>You lost</p>
      <p class="final-score">Score: <span id="final-score">0</span></p>
      <button id="btn-again">Play again</button>
    </div>
  </div>

  <div id="smart-info-modal" class="modal hidden">
    <div class="modal-backdrop smart-info-backdrop"></div>
    <div class="modal-box">
      <h2>Smart mode characters</h2>
      <p class="modal-hint">Smart mode uses <strong>only characters from your stats</strong> (kana you’ve correctly typed in other modes), filtered by the Script you chose (Hiragana / Katakana / Both). It picks characters with <strong>low counts more often</strong> so you practice weak ones. Red = under 10 (need practice). List below is sorted lowest first and matches the current Script.</p>
      <div id="smart-info-list" class="stats-list"></div>
      <button type="button" id="smart-info-close" class="btn-primary">Close</button>
    </div>
  </div>

  <div id="sessions-modal" class="modal hidden">
    <div class="modal-backdrop sessions-modal-backdrop"></div>
    <div class="modal-box">
      <h2>Session history</h2>
      <p class="modal-hint">Past games (Quit or Game over).</p>
      <div class="stats-filters">
        <label>Mode</label>
        <select id="sessions-filter-mode">
          <option value="all">All</option>
          <option value="single">Single letter</option>
          <option value="random">Random combo</option>
          <option value="smart">Smart</option>
          <option value="words">Words</option>
          <option value="images">Images</option>
          <option value="english">English</option>
          <option value="kana-to-english">Kana to English</option>
        </select>
        <label>Sort</label>
        <select id="sessions-sort">
          <option value="newest">Newest first</option>
          <option value="oldest">Oldest first</option>
          <option value="score-desc">Score (high first)</option>
          <option value="score-asc">Score (low first)</option>
        </select>
      </div>
      <div id="sessions-modal-list" class="sessions-list"></div>
      <button type="button" id="sessions-modal-close" class="btn-primary">Close</button>
    </div>
  </div>

  <div id="stats-modal" class="modal hidden">
    <div class="modal-backdrop stats-modal-backdrop"></div>
    <div class="modal-box">
      <h2>Kana stats</h2>
      <p class="modal-hint">Total correct inputs (all games). Red = under 10 (need practice).</p>
      <div class="stats-filters">
        <label>Script</label>
        <select id="stats-filter-script">
          <option value="all">All</option>
          <option value="hiragana">Hiragana only</option>
          <option value="katakana">Katakana only</option>
        </select>
        <label>Sort</label>
        <select id="stats-sort">
          <option value="highest">Highest first</option>
          <option value="lowest">Lowest first</option>
        </select>
      </div>
      <div id="stats-modal-list" class="stats-list"></div>
      <button type="button" id="stats-modal-close" class="btn-primary">Close</button>
    </div>
  </div>

  <div id="custom-modal" class="modal hidden">
    <div class="modal-backdrop"></div>
    <div class="modal-box">
      <h2>Select characters</h2>
      <p class="modal-hint">Check the characters you want. Save as a profile to reuse later.</p>
      <div class="custom-profile-row">
        <label for="custom-profile-list">Profile</label>
        <select id="custom-profile-list">
          <option value="">— Select profile —</option>
        </select>
        <button type="button" id="custom-profile-load" class="btn-profile">Load</button>
        <button type="button" id="custom-profile-save" class="btn-profile">Save as new</button>
        <button type="button" id="custom-profile-rename" class="btn-profile">Rename</button>
        <button type="button" id="custom-profile-delete" class="btn-profile">Delete</button>
      </div>
      <div class="modal-actions">
        <button type="button" id="custom-select-all">Select all</button>
        <button type="button" id="custom-deselect-all">Deselect all</button>
      </div>
      <div class="custom-filter-actions">
        <span class="filter-group">Hiragana: <button type="button" id="custom-select-hiragana">Select</button> <button type="button" id="custom-deselect-hiragana">Deselect</button></span>
        <span class="filter-group">Katakana: <button type="button" id="custom-select-katakana">Select</button> <button type="button" id="custom-deselect-katakana">Deselect</button></span>
        <span class="filter-group">Ten-ten: <button type="button" id="custom-select-dakuten">Select</button> <button type="button" id="custom-deselect-dakuten">Deselect</button></span>
        <span class="filter-group">Handakuten: <button type="button" id="custom-select-handakuten">Select</button> <button type="button" id="custom-deselect-handakuten">Deselect</button></span>
      </div>
      <h3 class="custom-section">Hiragana</h3>
      <div id="custom-hiragana" class="custom-grid"></div>
      <h3 class="custom-section">Katakana</h3>
      <div id="custom-katakana" class="custom-grid"></div>
      <button type="button" id="custom-done" class="btn-primary">Done</button>
    </div>
  </div>

  <div id="export-modal" class="modal hidden">
    <div class="modal-backdrop export-modal-backdrop"></div>
    <div class="modal-box">
      <h2>Export data</h2>
      <p class="modal-hint">Choose what to include. Default: words only.</p>
      <div class="export-options">
        <label class="opt-checkbox"><input type="checkbox" id="export-words" checked> Words</label>
        <label class="opt-checkbox"><input type="checkbox" id="export-sessions"> Sessions</label>
        <label class="opt-checkbox"><input type="checkbox" id="export-stats"> Character stats</label>
        <label class="opt-checkbox"><input type="checkbox" id="export-profiles"> Character profiles</label>
        <label class="opt-checkbox"><input type="checkbox" id="export-settings"> Settings</label>
        <label class="opt-checkbox"><input type="checkbox" id="export-customChars"> Current custom chars</label>
      </div>
      <button type="button" id="export-download" class="btn-primary">Download JSON</button>
      <button type="button" id="export-modal-close" class="btn-secondary">Cancel</button>
    </div>
  </div>

  <div id="import-modal" class="modal hidden">
    <div class="modal-backdrop import-modal-backdrop"></div>
    <div class="modal-box">
      <h2>Import data</h2>
      <p class="modal-hint">Select a previously exported JSON file.</p>
      <input type="file" id="import-file" accept=".json,application/json">
      <div id="import-options" class="import-options hidden">
        <p class="modal-hint">Choose what to import (from file):</p>
        <label class="opt-checkbox"><input type="checkbox" id="import-words"> Words</label>
        <label class="opt-checkbox"><input type="checkbox" id="import-sessions"> Sessions</label>
        <label class="opt-checkbox"><input type="checkbox" id="import-stats"> Character stats</label>
        <label class="opt-checkbox"><input type="checkbox" id="import-profiles"> Character profiles</label>
        <label class="opt-checkbox"><input type="checkbox" id="import-settings"> Settings</label>
        <label class="opt-checkbox"><input type="checkbox" id="import-customChars"> Current custom chars</label>
        <span class="import-mode-wrap"><label class="opt-checkbox"><input type="radio" name="import-mode" value="replace" checked> Replace</label>
        <label class="opt-checkbox"><input type="radio" name="import-mode" value="merge"> Merge</label></span>
      </div>
      <button type="button" id="import-do" class="btn-primary hidden">Import</button>
      <button type="button" id="import-modal-close" class="btn-secondary">Close</button>
    </div>
  </div>

  <script src="/db.js"></script>
  <script src="/romaji-to-kana.js"></script>
  <script src="/game/script.js"></script>
</body>
</html>
